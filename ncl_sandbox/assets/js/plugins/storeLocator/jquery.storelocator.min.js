/*! jQuery Google Maps Store Locator - v2.4.2 - 2016-01-20
* http://www.bjornblog.com/web/jquery-store-locator-plugin
* Copyright (c) 2016 Bjorn Holine; Licensed MIT */

!function(a,b,c,d){"use strict";function e(b,c){g=a(b),this.element=b,this.settings=a.extend({},F,c),this._defaults=F,this._name=f,this.init()}var f="storeLocator";if("undefined"==typeof a.fn[f]&&"undefined"!=typeof google){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=[],y=[],z=[],A=[],B={},C={},D={},E={},F={mapID:"bh-sl-map",locationList:"bh-sl-loc-list",formContainer:"bh-sl-form-container",formID:"bh-sl-user-location",addressID:"bh-sl-address",regionID:"bh-sl-region",mapSettings:{zoom:12,mapTypeId:google.maps.MapTypeId.ROADMAP},markerImg:null,markerDim:null,catMarkers:null,selectedMarkerImg:null,selectedMarkerImgDim:null,lengthUnit:"m",storeLimit:26,distanceAlert:60,dataType:"xml",dataLocation:"data/locations.xml",dataRaw:null,xmlElement:"marker",listColor1:"#ffffff",listColor2:"#eeeeee",originMarker:!1,originMarkerImg:null,originMarkerDim:null,bounceMarker:!0,slideMap:!0,modal:!1,overlay:"bh-sl-overlay",modalWindow:"bh-sl-modal-window",modalContent:"bh-sl-modal-content",closeIcon:"bh-sl-close-icon",defaultLoc:!1,defaultLat:null,defaultLng:null,autoComplete:!1,autoGeocode:!1,maxDistance:!1,maxDistanceID:"bh-sl-maxdistance",fullMapStart:!1,fullMapStartBlank:!1,fullMapStartListLimit:!1,noForm:!1,loading:!1,loadingContainer:"bh-sl-loading",featuredLocations:!1,pagination:!1,locationsPerPage:10,inlineDirections:!1,nameSearch:!1,searchID:"bh-sl-search",nameAttribute:"name",visibleMarkersList:!1,infowindowTemplatePath:"assets/js/plugins/storeLocator/templates/infowindow-description.html",listTemplatePath:"assets/js/plugins/storeLocator/templates/location-list-description.html",KMLinfowindowTemplatePath:"assets/js/plugins/storeLocator/templates/kml-infowindow-description.html",KMLlistTemplatePath:"assets/js/plugins/storeLocator/templates/kml-location-list-description.html",listTemplateID:null,infowindowTemplateID:null,taxonomyFilters:null,taxonomyFiltersContainer:"bh-sl-filters-container",exclusiveFiltering:!1,querystringParams:!1,debug:!1,sessionStorage:!1,callbackNotify:null,callbackBeforeSend:null,callbackSuccess:null,callbackModalOpen:null,callbackModalReady:null,callbackModalClose:null,callbackJsonp:null,callbackPageChange:null,callbackDirectionsRequest:null,callbackCloseDirections:null,callbackNoResults:null,callbackListClick:null,callbackMarkerClick:null,callbackFilters:null,addressErrorAlert:"Unable to find address",autoGeocodeErrorAlert:"Automatic location detection failed. Please fill in your address or zip code.",distanceErrorAlert:"Unfortunately, our closest location is more than ",mileLang:"mile",milesLang:"miles",kilometerLang:"kilometer",kilometersLang:"kilometers",noResultsTitle:"No results",noResultsDesc:"No locations were found with the given criteria. Please modify your selections or input.",nextPage:"Next &raquo;",prevPage:"&laquo; Prev"};a.extend(e.prototype,{init:function(){if(this.writeDebug("init"),D.EarthRadius="km"===this.settings.lengthUnit?6367:3956,j="kml"===this.settings.dataType?"xml":this.settings.dataType,this.settings.inlineDirections===!0&&a("."+this.settings.locationList).prepend('<div class="bh-sl-directions-panel"></div>'),m=this.settings.mapSettings.zoom,Handlebars.registerHelper("niceURL",function(a){return a?a.replace("https://","").replace("http://",""):void 0}),null!==this.settings.taxonomyFilters&&this.taxonomyFiltering(),this.settings.modal===!0&&(null!==this.settings.taxonomyFilters&&a("."+this.settings.taxonomyFiltersContainer).clone(!0,!0).prependTo(g),g.wrap('<div class="'+this.settings.overlay+'"><div class="'+this.settings.modalWindow+'"><div class="'+this.settings.modalContent+'">'),a("."+this.settings.modalWindow).prepend('<div class="'+this.settings.closeIcon+'"></div>'),a("."+this.settings.overlay).hide()),this.settings.autoComplete===!0){var b=c.getElementById(this.settings.addressID);new google.maps.places.Autocomplete(b)}this._loadTemplates()},destroy:function(){this.writeDebug("destroy"),this.reset();var b=a("#"+this.settings.mapID);if(A.length)for(var d=0;d<=A.length;d++)google.maps.event.removeListener(A[d]);a("."+this.settings.locationList+" ul").empty(),b.hasClass("bh-sl-map-open")&&b.empty().removeClass("bh-sl-map-open"),this.settings.modal===!0&&a(". "+this.settings.overlay).remove(),b.attr("style",""),g.hide(),a.removeData(g.get(0)),a(c).off(f),g.unbind()},reset:function(){if(this.writeDebug("reset"),y=[],x=[],z=[],A=[],a(c).off("click."+f,"."+this.settings.locationList+" li"),a("."+this.settings.locationList+" .bh-sl-close-directions-container").length&&a(".bh-sl-close-directions-container").remove(),this.settings.inlineDirections===!0){var b=a("."+this.settings.locationList+" .adp");b.length>0&&(b.remove(),a("."+this.settings.locationList+" ul").fadeIn()),a(c).off("click","."+this.settings.locationList+" li .loc-directions a")}},notify:function(a){this.writeDebug("notify",a),this.settings.callbackNotify?this.settings.callbackNotify.call(this,a):alert(a)},geoCodeCalcToRadian:function(a){return this.writeDebug("geoCodeCalcToRadian",a),a*(Math.PI/180)},geoCodeCalcDiffRadian:function(a,b){return this.writeDebug("geoCodeCalcDiffRadian",arguments),this.geoCodeCalcToRadian(b)-this.geoCodeCalcToRadian(a)},geoCodeCalcCalcDistance:function(a,b,c,d,e){return this.writeDebug("geoCodeCalcCalcDistance",arguments),2*e*Math.asin(Math.min(1,Math.sqrt(Math.pow(Math.sin(this.geoCodeCalcDiffRadian(a,c)/2),2)+Math.cos(this.geoCodeCalcToRadian(a))*Math.cos(this.geoCodeCalcToRadian(c))*Math.pow(Math.sin(this.geoCodeCalcDiffRadian(b,d)/2),2))))},getQueryString:function(a){if(this.writeDebug("getQueryString",a),a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))}},_loadTemplates:function(){this.writeDebug("_loadTemplates");var b,c=this,d='<div class="bh-sl-error">Error: Could not load plugin templates. Check the paths and ensure they have been uploaded. Paths will be wrong if you do not run this from a web server.</div>';"kml"===this.settings.dataType&&null===this.settings.listTemplateID&&null===this.settings.infowindowTemplateID?a.when(a.get(this.settings.KMLinfowindowTemplatePath,function(a){b=a,i=Handlebars.compile(b)}),a.get(this.settings.KMLlistTemplatePath,function(a){b=a,h=Handlebars.compile(b)})).then(function(){c.locator()},function(){throw a("."+c.settings.formContainer).append(d),new Error("Could not load storeLocator plugin templates")}):null!==this.settings.listTemplateID&&null!==this.settings.infowindowTemplateID?(i=Handlebars.compile(a("#"+this.settings.infowindowTemplateID).html()),h=Handlebars.compile(a("#"+this.settings.listTemplateID).html()),c.locator()):a.when(a.get(this.settings.infowindowTemplatePath,function(a){b=a,i=Handlebars.compile(b)}),a.get(this.settings.listTemplatePath,function(a){b=a,h=Handlebars.compile(b)})).then(function(){c.locator()},function(){throw a("."+c.settings.formContainer).append(d),new Error("Could not load storeLocator plugin templates")})},locator:function(){this.writeDebug("locator"),this.settings.slideMap===!0&&g.hide(),this._start(),this._formEventHandler()},_formEventHandler:function(){this.writeDebug("_formEventHandler");var b=this;this.settings.noForm===!0?(a(c).on("click."+f,"."+this.settings.formContainer+" button",function(a){b.processForm(a)}),a(c).on("keydown."+f,function(c){13===c.keyCode&&a("#"+b.settings.addressID).is(":focus")&&b.processForm(c)})):a(c).on("submit."+f,"#"+this.settings.formID,function(a){b.processForm(a)})},_getData:function(b,c,d){this.writeDebug("_getData",arguments);var e=this;if(this.settings.callbackBeforeSend&&this.settings.callbackBeforeSend.call(this,b,c,d),null===e.settings.dataRaw){var f=a.Deferred();return this.settings.loading===!0&&a("."+this.settings.formContainer).append('<div class="'+this.settings.loadingContainer+'"></div>'),a.ajax({type:"GET",url:this.settings.dataLocation+("jsonp"===this.settings.dataType?(this.settings.dataLocation.match(/\?/)?"&":"?")+"callback=?":""),data:{origLat:b,origLng:c,origAddress:d},dataType:j,jsonpCallback:"jsonp"===this.settings.dataType?this.settings.callbackJsonp:null}).done(function(b){f.resolve(b),e.settings.loading===!0&&a("."+e.settings.formContainer+" ."+e.settings.loadingContainer).remove()}).fail(f.reject),f.promise()}return"xml"===j?a.parseXML(e.settings.dataRaw):"json"===j?Array.isArray&&Array.isArray(e.settings.dataRaw)?e.settings.dataRaw:"string"==typeof e.settings.dataRaw?a.parseJSON(e.settings.dataRaw):[]:void 0},_start:function(){this.writeDebug("_start");var d,e=this,f=this.settings.autoGeocode;if(e.settings.fullMapStartBlank!==!1){var g=a("#"+e.settings.mapID);g.addClass("bh-sl-map-open");var h=e.settings.mapSettings;h.zoom=e.settings.fullMapStartBlank,d=new google.maps.LatLng(this.settings.defaultLat,this.settings.defaultLng),h.center=d;var i=new google.maps.Map(c.getElementById(e.settings.mapID),h);google.maps.event.addDomListener(b,"resize",function(){var a=i.getCenter();google.maps.event.trigger(i,"resize"),i.setCenter(a)}),e.settings.fullMapStartBlank=!1,h.zoom=m}else{if(this.settings.defaultLoc===!0){var j=new this.reverseGoogleGeocode(this);d=new google.maps.LatLng(this.settings.defaultLat,this.settings.defaultLng),j.geocode({latLng:d},function(a){if(null!==a){var b=a.address;q=E.lat=e.settings.defaultLat,r=E.lng=e.settings.defaultLng,E.origin=b,e.mapping(E)}else e.notify(e.settings.addressErrorAlert)})}if(""!==a("#"+this.settings.addressID).val().trim()?(e.writeDebug("Using Address Field"),e.processForm(null),f=!1):this.settings.fullMapStart===!0&&(this.settings.querystringParams===!0&&this.getQueryString(this.settings.addressID)||this.settings.querystringParams===!0&&this.getQueryString(this.settings.searchID)||this.settings.querystringParams===!0&&this.getQueryString(this.settings.maxDistanceID)?(e.writeDebug("Using Query String"),this.processForm(null),f=!1):this.mapping(null)),this.settings.autoGeocode===!0&&f===!0){if(e.writeDebug("Auto Geo"),e.settings.sessionStorage===!0&&b.sessionStorage&&b.sessionStorage.getItem("myGeo"))return e.writeDebug("Using Session Saved Values for GEO"),e.autoGeocodeQuery(JSON.parse(b.sessionStorage.getItem("myGeo"))),!1;navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(a){e.writeDebug("Current Position Result");var c={coords:{latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy}};e.settings.sessionStorage===!0&&b.sessionStorage&&b.sessionStorage.setItem("myGeo",JSON.stringify(c)),e.autoGeocodeQuery(c)},function(a){e._autoGeocodeError(a)})}}},googleGeocode:function(a){a.writeDebug("googleGeocode",arguments);var b=new google.maps.Geocoder;this.geocode=function(a,c){b.geocode(a,function(a,b){if(b!==google.maps.GeocoderStatus.OK)throw c(null),new Error("Geocode was not successful for the following reason: "+b);var d={};d.latitude=a[0].geometry.location.lat(),d.longitude=a[0].geometry.location.lng(),c(d)})}},reverseGoogleGeocode:function(a){a.writeDebug("reverseGoogleGeocode",arguments);var b=new google.maps.Geocoder;this.geocode=function(a,c){b.geocode(a,function(a,b){if(b!==google.maps.GeocoderStatus.OK)throw c(null),new Error("Reverse geocode was not successful for the following reason: "+b);if(a[0]){var d={};d.address=a[0].formatted_address,c(d)}})}},roundNumber:function(a,b){return this.writeDebug("roundNumber",arguments),Math.round(a*Math.pow(10,b))/Math.pow(10,b)},isEmptyObject:function(a){this.writeDebug("isEmptyObject",arguments);for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},hasEmptyObjectVals:function(a){this.writeDebug("hasEmptyObjectVals",arguments);var b=!0;for(var c in a)a.hasOwnProperty(c)&&""!==a[c]&&0!==a[c].length&&(b=!1);return b},modalClose:function(){this.writeDebug("modalClose"),this.settings.callbackModalClose&&this.settings.callbackModalClose.call(this),B={},a("."+this.settings.overlay+" select").prop("selectedIndex",0),a("."+this.settings.overlay+" input").prop("checked",!1),a("."+this.settings.overlay).hide()},_createLocationVariables:function(a){this.writeDebug("_createLocationVariables",arguments);var b;for(var c in y[a])y[a].hasOwnProperty(c)&&(b=y[a][c],"distance"===c&&(b=this.roundNumber(b,2)),C[c]=b)},sortNumerically:function(a){this.writeDebug("sortNumerically",arguments),a.sort(function(a,b){return a.distance<b.distance?-1:a.distance>b.distance?1:0})},filterData:function(a,b){this.writeDebug("filterData",arguments);var c=!0;for(var d in b)if(b.hasOwnProperty(d))if(this.settings.exclusiveFiltering===!0){for(var e=b[d],f=[],g=0;g<e.length;g++)f[g]=new RegExp(e[g],"i").test(a[d]);-1===f.indexOf(!0)&&(c=!1)}else new RegExp(b[d].join(""),"i").test(a[d])||(c=!1);return c?!0:void 0},_paginationOutput:function(a,b){this.writeDebug("_paginationOutput",arguments),a=parseFloat(a);var c="",d=a+1,e=a-1;a>0&&(c+='<li class="bh-sl-next-prev" data-page="'+e+'">'+this.settings.prevPage+"</li>");for(var f=0;f<Math.ceil(b);f++){var g=f+1;c+=f===a?'<li class="bh-sl-current" data-page="'+f+'">'+g+"</li>":'<li data-page="'+f+'">'+g+"</li>"}return b>d&&(c+='<li class="bh-sl-next-prev" data-page="'+d+'">'+this.settings.nextPage+"</li>"),c},paginationSetup:function(b){this.writeDebug("paginationSetup",arguments);var c="",d=y.length/this.settings.locationsPerPage,e=a(".bh-sl-pagination-container .bh-sl-pagination");"undefined"==typeof b&&(b=0),0===e.length?c=this._paginationOutput(b,d):(e.empty(),c=this._paginationOutput(b,d)),e.append(c)},markerImage:function(a,b,c){this.writeDebug("markerImage",arguments);var d;return d="undefined"!=typeof b&&"undefined"!=typeof c?{url:a,size:new google.maps.Size(b,c),scaledSize:new google.maps.Size(b,c)}:{url:a,size:new google.maps.Size(32,32),scaledSize:new google.maps.Size(32,32)}},createMarker:function(a,b,c,d,e,f){this.writeDebug("createMarker",arguments);var g,h,i,j=[];if("undefined"!=typeof f&&f.length&&(f=f.replace(/\s+/g,"")),null!==this.settings.catMarkers&&"undefined"!=typeof f)if(-1!==f.indexOf(",")){j=f.split(",");for(var k=0;k<j.length;k++)j[k]in this.settings.catMarkers&&(h=this.markerImage(this.settings.catMarkers[j[k]][0],this.settings.catMarkers[j[k]][1],this.settings.catMarkers[j[k]][2]))}else f in this.settings.catMarkers&&(h=this.markerImage(this.settings.catMarkers[f][0],this.settings.catMarkers[f][1],this.settings.catMarkers[f][2]));return null!==this.settings.markerImg&&(h=null===this.settings.markerDim?this.markerImage(this.settings.markerImg):this.markerImage(this.settings.markerImg,this.settings.markerDim.width,this.settings.markerDim.height)),-1===this.settings.storeLimit||this.settings.storeLimit>26||null!==this.settings.catMarkers||null!==this.settings.markerImg?g=new google.maps.Marker({position:a,map:e,draggable:!1,icon:h}):(i={url:"https://mt.googleapis.com/vt/icon/name=icons/spotlight/spotlight-waypoint-b.png&text="+d+"&psize=16&font=fonts/Roboto-Regular.ttf&color=ff333333&ax=44&ay=48"},g=new google.maps.Marker({position:a,map:e,icon:i,draggable:!1})),g},_defineLocationData:function(b,c,d){this.writeDebug("_defineLocationData",arguments);var e="";this._createLocationVariables(b.get("id"));var f;f=C.distance<=1?"km"===this.settings.lengthUnit?this.settings.kilometerLang:this.settings.mileLang:"km"===this.settings.lengthUnit?this.settings.kilometersLang:this.settings.milesLang;var g=b.get("id");return e=-1===this.settings.storeLimit||this.settings.storeLimit>26?g+1:String.fromCharCode(d>0?"A".charCodeAt(0)+(c+g):"A".charCodeAt(0)+g),{location:[a.extend(C,{markerid:g,marker:e,length:f,origin:k})]}},listSetup:function(b,c,d){this.writeDebug("listSetup",arguments);var e=this._defineLocationData(b,c,d),f=h(e);a("."+this.settings.locationList+" ul").append(f)},changeSelectedMarker:function(a){var b;"undefined"!=typeof w&&w.setIcon(v),b=null===this.settings.selectedMarkerImgDim?this.markerImage(this.settings.selectedMarkerImg):this.markerImage(this.settings.selectedMarkerImg,this.settings.selectedMarkerImgDim.width,this.settings.selectedMarkerImgDim.height),v=a.icon,a.setIcon(b),w=a},createInfowindow:function(b,c,d,e,f){this.writeDebug("createInfowindow",arguments);var g=this,h=this._defineLocationData(b,e,f),j=i(h);"left"===c?(d.setContent(j),d.open(b.get("map"),b)):google.maps.event.addListener(b,"click",function(){d.setContent(j),d.open(b.get("map"),b);var c=b.get("id"),e=a("."+g.settings.locationList+" li[data-markerid="+c+"]");if(e.length>0){g.settings.callbackMarkerClick&&g.settings.callbackMarkerClick.call(this,b,c,e),a("."+g.settings.locationList+" li").removeClass("list-focus"),e.addClass("list-focus");var f=a("."+g.settings.locationList);f.animate({scrollTop:e.offset().top-f.offset().top+f.scrollTop()})}null!==g.settings.selectedMarkerImg&&g.changeSelectedMarker(b)})},autoGeocodeQuery:function(a){this.writeDebug("autoGeocodeQuery",arguments);var b=this,c={},d=new this.reverseGoogleGeocode(this),e=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);d.geocode({latLng:e},function(d){if(null!==d){var e=d.address;q=c.lat=a.coords.latitude,r=c.lng=a.coords.longitude,c.origin=e,b.mapping(c)}else b.notify(b.settings.addressErrorAlert)})},_autoGeocodeError:function(){this.writeDebug("_autoGeocodeError"),this.notify(this.settings.autoGeocodeErrorAlert)},paginationChange:function(a){this.writeDebug("paginationChange",arguments),this.settings.callbackPageChange&&this.settings.callbackPageChange.call(this,a),E.page=a,this.mapping(E)},getAddressByMarker:function(a){this.writeDebug("getAddressByMarker",arguments);var b="";return y[a].address&&(b+=y[a].address+" "),y[a].address2&&(b+=y[a].address2+" "),y[a].city&&(b+=y[a].city+", "),y[a].state&&(b+=y[a].state+" "),y[a].postal&&(b+=y[a].postal+" "),y[a].country&&(b+=y[a].country+" "),b},clearMarkers:function(){this.writeDebug("clearMarkers");var a=null;a=y.length<this.settings.storeLimit?y.length:this.settings.storeLimit;for(var b=0;a>b;b++)A[b].setMap(null)},directionsRequest:function(b,d,e){this.writeDebug("directionsRequest",arguments),this.settings.callbackDirectionsRequest&&this.settings.callbackDirectionsRequest.call(this,b,d,e);var f=this.getAddressByMarker(d);if(f){a("."+this.settings.locationList+" ul").hide(),this.clearMarkers(),null!==t&&"undefined"!=typeof t&&(t.setMap(null),t=null),t=new google.maps.DirectionsRenderer,u=new google.maps.DirectionsService,t.setMap(e),t.setPanel(a(".bh-sl-directions-panel").get(0));var g={origin:b,destination:f,travelMode:google.maps.TravelMode.DRIVING};u.route(g,function(a,b){b===google.maps.DirectionsStatus.OK&&t.setDirections(a)}),a("."+this.settings.locationList).prepend('<div class="bh-sl-close-directions-container"><div class="'+this.settings.closeIcon+'"></div></div>')}a(c).off("click","."+this.settings.locationList+" li .loc-directions a")},closeDirections:function(){this.writeDebug("closeDirections"),this.settings.callbackCloseDirections&&this.settings.callbackCloseDirections.call(this),this.reset(),q&&r&&(this.settings.mapSettings.zoom=0===this.countFilters()?m:0,this.processForm(null)),a(c).off("click."+f,"."+this.settings.locationList+" .bh-sl-close-icon")},processForm:function(b){this.writeDebug("processForm",arguments);var c=this,d=null,e=a("#"+this.settings.addressID),f=a("#"+this.settings.searchID),g=a("#"+this.settings.maxDistanceID);"undefined"!=typeof b&&null!==b&&b.preventDefault(),this.settings.querystringParams===!0&&(this.getQueryString(this.settings.addressID)||this.getQueryString(this.settings.searchID)||this.getQueryString(this.settings.maxDistanceID))?(p=this.getQueryString(this.settings.addressID),o=this.getQueryString(this.settings.searchID),d=this.getQueryString(this.settings.maxDistanceID),""!==a("#"+this.settings.addressID).val()&&(p=e.val()),""!==f.val()&&(o=f.val()),""!==g.val()&&(d=g.val())):(p=e.val()||"",o=f.val()||"",this.settings.maxDistance===!0&&(d=g.val()||""));var h=a("#"+this.settings.regionID).val();if(""===p&&""===o)this._start();else if(""!==p)if("undefined"!=typeof k&&"undefined"!=typeof q&&"undefined"!=typeof r&&p===k)E.lat=q,E.lng=r,E.origin=p,E.name=o,E.distance=d,c.mapping(E);else{var i=new this.googleGeocode(this);i.geocode({address:p,region:h},function(a){null!==a?(q=a.latitude,r=a.longitude,E.lat=q,E.lng=r,E.origin=p,E.name=o,E.distance=d,c.mapping(E)):c.notify(c.settings.addressErrorAlert)})}else""!==o&&(E.name=o,c.mapping(E))},locationsSetup:function(a,b,c,d,e,f){if(this.writeDebug("locationsSetup",arguments),"undefined"!=typeof e&&(a.distance||(a.distance=this.geoCodeCalcCalcDistance(b,c,a.lat,a.lng,D.EarthRadius))),this.settings.maxDistance===!0&&d!==!0&&"undefined"!=typeof f&&null!==f){if(!(a.distance<=f))return;y.push(a)}else if(this.settings.maxDistance===!0&&this.settings.querystringParams===!0&&this.settings.maxDistance===!0&&"undefined"!=typeof f&&null!==f){if(!(a.distance<=f))return;y.push(a)}else y.push(a)},countFilters:function(){this.writeDebug("countFilters");var a=0;if(!this.isEmptyObject(B))for(var b in B)B.hasOwnProperty(b)&&(a+=B[b].length);return a},_existingCheckedFilters:function(b){this.writeDebug("_existingCheckedFilters",arguments),a("#"+this.settings.taxonomyFilters[b]+" input[type=checkbox]").each(function(){if(a(this).prop("checked")){var c=a(this).val();"undefined"!=typeof c&&""!==c&&-1===B[b].indexOf(c)&&B[b].push(c)}})},_existingSelectedFilters:function(b){this.writeDebug("_existingSelectedFilters",arguments),a("#"+this.settings.taxonomyFilters[b]+" select").each(function(){var c=a(this).val();"undefined"!=typeof c&&""!==c&&-1===B[b].indexOf(c)&&(B[b]=[c])})},_existingRadioFilters:function(b){this.writeDebug("_existingRadioFilters",arguments),a("#"+this.settings.taxonomyFilters[b]+" input[type=radio]").each(function(){if(a(this).prop("checked")){var c=a(this).val();"undefined"!=typeof c&&""!==c&&-1===B[b].indexOf(c)&&(B[b]=[c])}})},checkFilters:function(){this.writeDebug("checkFilters");for(var a in this.settings.taxonomyFilters)this.settings.taxonomyFilters.hasOwnProperty(a)&&(this._existingCheckedFilters(a),this._existingSelectedFilters(a),this._existingRadioFilters(a))},getFilterKey:function(a){this.writeDebug("getFilterKey",arguments);for(var b in this.settings.taxonomyFilters)if(this.settings.taxonomyFilters.hasOwnProperty(b))for(var c=0;c<this.settings.taxonomyFilters[b].length;c++)if(this.settings.taxonomyFilters[b]===a)return b},taxonomyFiltering:function(){this.writeDebug("taxonomyFiltering");var b=this;for(var c in this.settings.taxonomyFilters)this.settings.taxonomyFilters.hasOwnProperty(c)&&(B[c]=[]);a("."+this.settings.taxonomyFiltersContainer).on("change."+f,"input, select",function(c){c.stopPropagation();var d,e,f;if(a(this).is('input[type="checkbox"]')){if(b.checkFilters(),d=a(this).val(),e=a(this).closest(".bh-sl-filters").attr("id"),f=b.getFilterKey(e))if(a(this).prop("checked"))-1===B[f].indexOf(d)&&B[f].push(d),a("#"+b.settings.mapID).hasClass("bh-sl-map-open")===!0&&(q&&r?(b.settings.mapSettings.zoom=0,b.processForm()):b.mapping(E));else{var g=B[f].indexOf(d);g>-1&&(B[f].splice(g,1),a("#"+b.settings.mapID).hasClass("bh-sl-map-open")===!0&&(q&&r?(b.settings.mapSettings.zoom=0===b.countFilters()?m:0,b.processForm()):b.mapping(E)))}}else(a(this).is("select")||a(this).is('input[type="radio"]'))&&(b.checkFilters(),d=a(this).val(),e=a(this).closest(".bh-sl-filters").attr("id"),f=b.getFilterKey(e),d?f&&(B[f]=[d],a("#"+b.settings.mapID).hasClass("bh-sl-map-open")===!0&&(q&&r?(b.settings.mapSettings.zoom=0,b.processForm()):b.mapping(E))):(f&&(B[f]=[]),b.reset(),q&&r?(b.settings.mapSettings.zoom=m,b.processForm()):b.mapping(E)))})},checkVisibleMarkers:function(b,c){this.writeDebug("checkVisibleMarkers",arguments);var d,e,f=this;a("."+this.settings.locationList+" ul").empty(),a(b).each(function(b,g){c.getBounds().contains(g.getPosition())&&(f.listSetup(g,0,0),e=h(d),a("."+f.settings.locationList+" ul").append(e))})},mapping:function(a){this.writeDebug("mapping",a);var b,c,d,e,f,g=this;this.isEmptyObject(a)||(b=a.lat,c=a.lng,d=a.origin,f=a.page),g.settings.pagination===!0&&("undefined"==typeof f||k!==p)&&(f=0),"undefined"==typeof d&&this.settings.nameSearch===!0?n=g._getData():(e=new google.maps.LatLng(b,c),"undefined"!=typeof k&&d===k&&"undefined"!=typeof l?(d=k,n=l):n=g._getData(q,r,d)),null!==g.settings.taxonomyFilters&&g.hasEmptyObjectVals(B)&&g.checkFilters(),null!==g.settings.dataRaw?g.processData(a,e,n,f):n.done(function(b){g.processData(a,e,b,f)})},processData:function(d,e,h,i){this.writeDebug("processData",d);var j,m,p,q,r,t,u,v,w,C,D,E,F,G=this,H=0;this.isEmptyObject(d)||(j=d.lat,m=d.lng,p=d.origin,q=d.name,r=d.distance);var I=a("#"+G.settings.mapID),J="km"===G.settings.lengthUnit?G.settings.kilometersLang:G.settings.milesLang;if(l=n,k=p,G.settings.callbackSuccess&&G.settings.callbackSuccess.call(this),G.settings.fullMapStart===!0&&I.hasClass("bh-sl-map-open")===!1?t=!0:G.reset(),I.addClass("bh-sl-map-open"),"json"===G.settings.dataType||"jsonp"===G.settings.dataType)for(var K=0;H<h.length;K++){var L=h[K],M={};for(var N in L)L.hasOwnProperty(N)&&(M[N]=L[N]);G.locationsSetup(M,j,m,t,p,r),H++}else"kml"===G.settings.dataType?a(h).find("Placemark").each(function(){var b={name:a(this).find("name").text(),lat:a(this).find("coordinates").text().split(",")[1],lng:a(this).find("coordinates").text().split(",")[0],description:a(this).find("description").text()};G.locationsSetup(b,j,m,t,p,r),H++}):a(h).find(G.settings.xmlElement).each(function(){var a={};for(var b in this.attributes)this.attributes.hasOwnProperty(b)&&(a[this.attributes[b].name]=this.attributes[b].value);G.locationsSetup(a,j,m,t,p,r),H++});if(G.settings.nameSearch===!0&&"undefined"!=typeof o&&(B[G.settings.nameAttribute]=[o]),null!==G.settings.taxonomyFilters||G.settings.nameSearch===!0){var O={};for(var P in B)if(B.hasOwnProperty(P)&&B[P].length>0)for(var Q=0;Q<B[P].length;Q++)O[P]||(O[P]=[]),O[P][Q]="(?=.*\\b"+B[P][Q].replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")+"\\b)";G.isEmptyObject(O)||(y=a.grep(y,function(a){return G.filterData(a,O)}))}if(G.isEmptyObject(y)&&(G.settings.callbackNoResults&&G.settings.callbackNoResults.call(this),E=a('<li><div class="bh-sl-noresults-title">'+G.settings.noResultsTitle+'</div><br><div class="bh-sl-noresults-desc">'+G.settings.noResultsDesc+"</li>").hide().fadeIn(),y[0]={distance:0,lat:0,lng:0}),"undefined"!=typeof p&&G.sortNumerically(y),G.settings.featuredLocations===!0&&(x=a.grep(y,function(a){return"true"===a.featured}),z=a.grep(y,function(a){return"true"!==a.featured}),y=[],y=x.concat(z)),G.settings.maxDistance===!0&&t!==!0&&r){if("undefined"==typeof y[0]||y[0].distance>r)return void G.notify(G.settings.distanceErrorAlert+r+" "+J)}else-1!==G.settings.distanceAlert&&y[0].distance>G.settings.distanceAlert&&(G.notify(G.settings.distanceErrorAlert+G.settings.distanceAlert+" "+J),F=!0);if(G.settings.pagination===!0&&G.paginationSetup(i),G.settings.slideMap===!0&&g.slideDown(),G.settings.modal===!0&&(G.settings.callbackModalOpen&&G.settings.callbackModalOpen.call(this),a("."+G.settings.overlay).fadeIn(),a(c).on("click."+f,"."+G.settings.closeIcon+", ."+G.settings.overlay,function(){G.modalClose()}),a(c).on("click."+f,"."+G.settings.modalWindow,function(a){a.stopPropagation()}),a(c).on("keyup."+f,function(a){27===a.keyCode&&G.modalClose()})),s=-1===G.settings.storeLimit||y.length<G.settings.storeLimit?y.length:G.settings.storeLimit,G.settings.pagination===!0?(C=G.settings.locationsPerPage,w=i*G.settings.locationsPerPage,w+C>y.length&&(C=G.settings.locationsPerPage-(w+C-y.length)),y=y.slice(w,w+C),s=y.length):(C=s,w=0),G.settings.fullMapStart===!0&&t===!0||0===G.settings.mapSettings.zoom||"undefined"==typeof p||F===!0)D=G.settings.mapSettings,v=new google.maps.LatLngBounds;else if(G.settings.pagination===!0){var R=new google.maps.LatLng(y[0].lat,y[0].lng);0===i?(G.settings.mapSettings.center=e,D=G.settings.mapSettings):(G.settings.mapSettings.center=R,D=G.settings.mapSettings)}else G.settings.mapSettings.center=e,D=G.settings.mapSettings;var S=new google.maps.Map(c.getElementById(G.settings.mapID),D);google.maps.event.addDomListener(b,"resize",function(){var a=S.getCenter();google.maps.event.trigger(S,"resize"),S.setCenter(a)}),g.data(G.settings.mapID.replace("#",""),S);var T=new google.maps.InfoWindow;if(G.settings.originMarker===!0){var U="";if(G.settings.fullMapStart===!1&&t===!0)return;U=null!==G.settings.originMarkerImg?null===G.settings.originMarkerDim?G.markerImage(G.settings.originMarkerImg):G.markerImage(G.settings.originMarkerImg,G.settings.originMarkerDim.width,G.settings.originMarkerDim.height):{url:"https://mt.googleapis.com/vt/icon/name=icons/spotlight/spotlight-waypoint-a.png"},u=new google.maps.Marker({position:e,map:S,icon:U,draggable:!1})}a(c).on("click."+f,".bh-sl-pagination li",function(){G.paginationChange(a(this).attr("data-page"))}),G.settings.inlineDirections===!0&&"undefined"!=typeof p&&a(c).on("click."+f,"."+G.settings.locationList+" li .loc-directions a",function(b){b.preventDefault();var d=a(this).closest("li").attr("data-markerid");G.directionsRequest(p,d,S),a(c).on("click."+f,"."+G.settings.locationList+" .bh-sl-close-icon",function(){G.closeDirections()})});for(var V=0;C-1>=V;V++){var W="";W=String.fromCharCode(i>0?"A".charCodeAt(0)+(w+V):"A".charCodeAt(0)+V);var X=new google.maps.LatLng(y[V].lat,y[V].lng);u=G.createMarker(X,y[V].name,y[V].address,W,S,y[V].category),u.set("id",V),A[V]=u,(G.settings.fullMapStart===!0&&t===!0||0===G.settings.mapSettings.zoom||"undefined"==typeof p||F===!0)&&v.extend(X),G.createInfowindow(u,null,T,w,i)}(G.settings.fullMapStart===!0&&t===!0||0===G.settings.mapSettings.zoom||"undefined"==typeof p||F===!0)&&S.fitBounds(v);var Y=a("."+G.settings.locationList+" ul");if(Y.empty(),0===y[0].lat&&0===y[0].lng)Y.append(E);else if(G.settings.fullMapStartListLimit===!1||isNaN(G.settings.fullMapStartListLimit))a(A).each(function(a){var b=A[a];G.listSetup(b,w,i)});else for(var Z=0;Z<G.settings.fullMapStartListLimit;Z++){var $=A[Z];G.listSetup($,w,i)}a(c).on("click."+f,"."+G.settings.locationList+" li",function(){var b=a(this).data("markerid"),c=A[b];G.settings.callbackListClick&&G.settings.callbackListClick.call(this,b,c),a("."+G.settings.locationList+" li").removeClass("list-focus"),a("."+G.settings.locationList+" li[data-markerid="+b+"]").addClass("list-focus"),S.panTo(c.getPosition());var d="left";G.settings.bounceMarker===!0?(c.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){c.setAnimation(null),G.createInfowindow(c,d,T,w,i)},700)):G.createInfowindow(c,d,T,w,i),null!==G.settings.selectedMarkerImg&&G.changeSelectedMarker(c)}),a(c).on("click."+f,"."+G.settings.locationList+" li a",function(a){a.stopPropagation()}),a("."+G.settings.locationList+" ul li:even").css("background",G.settings.listColor1),a("."+G.settings.locationList+" ul li:odd").css("background",G.settings.listColor2),G.settings.visibleMarkersList===!0&&(google.maps.event.addListenerOnce(S,"idle",function(){G.checkVisibleMarkers(A,S)}),google.maps.event.addListener(S,"center_changed",function(){G.checkVisibleMarkers(A,S)}),google.maps.event.addListener(S,"zoom_changed",function(){G.checkVisibleMarkers(A,S)})),G.settings.modal===!0&&G.settings.callbackModalReady&&G.settings.callbackModalReady.call(this),G.settings.callbackFilters&&G.settings.callbackFilters.call(this,B)},writeDebug:function(){b.console&&this.settings.debug&&(this.writeDebug=Function.prototype.bind?Function.prototype.bind.call(console.log,console,"StoreLocator :"):function(){arguments[0]="StoreLocator : "+arguments[0],Function.prototype.apply.call(console.log,console,arguments)},this.writeDebug.apply(this,arguments))}}),a.fn[f]=function(b){var c=arguments;if(b===d||"object"==typeof b)return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))});if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var g;return this.each(function(){var d=a.data(this,"plugin_"+f);d instanceof e&&"function"==typeof d[b]&&(g=d[b].apply(d,Array.prototype.slice.call(c,1))),"destroy"===b&&a.data(this,"plugin_"+f,null)}),g!==d?g:this}}}}(jQuery,window,document);